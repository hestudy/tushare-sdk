# Feature Specification: 文档站点 MCP 使用指南

**Feature Branch**: `015-mcp`
**Created**: 2025-10-14
**Status**: Draft
**Input**: User description: "在文档中补充mcp的用法,方便用户快速使用"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - AI 开发者快速理解 MCP 服务能力 (Priority: P1)

开发者希望在使用 Tushare SDK 文档站点时,能够快速了解项目提供的 MCP 服务是什么、能做什么,以及如何使用。他访问文档首页或指南页面时,能看到关于 MCP 服务的清晰介绍和使用说明。

**Why this priority**: 这是最核心的文档需求,让用户能够发现和理解 MCP 服务的存在。没有这部分内容,用户根本不知道项目提供了 MCP 服务,更谈不上使用。这是文档的 MVP。

**Independent Test**: 可以独立测试 - 访问文档站点的相关页面,检查是否包含 MCP 服务介绍、功能概述和使用场景说明。可以通过用户访问路径验证内容的可读性和完整性。

**Acceptance Scenarios**:

1. **Given** 用户访问文档站点首页, **When** 浏览功能特性列表, **Then** 能看到关于 MCP 服务的功能介绍,包括它提供的数据查询能力
2. **Given** 用户访问指南页面, **When** 查看目录结构, **Then** 能找到"MCP 使用指南"相关的导航链接或章节
3. **Given** 用户阅读 MCP 简介, **When** 查看功能说明, **Then** 能理解 MCP 服务支持查询的数据类型(股票行情、财务数据、K线数据、市场指数)

---

### User Story 2 - 开发者按照文档完成 MCP 服务配置 (Priority: P2)

开发者想要在自己的 AI 客户端(如 Claude Desktop)中使用 Tushare MCP 服务。他按照文档提供的步骤,完成安装、配置环境变量、设置客户端配置文件,最终成功连接 MCP 服务。

**Why this priority**: 配置步骤是用户使用 MCP 服务的前置条件。这个用户故事依赖于 P1 的概念理解,但是一旦用户理解了概念,配置过程是独立且必需的步骤。

**Independent Test**: 可以独立测试 - 新用户按照文档从零开始配置 MCP 服务,验证每个步骤是否清晰、准确且可执行,最终成功连接到 MCP 服务。

**Acceptance Scenarios**:

1. **Given** 用户已安装 Node.js 18+, **When** 按照文档执行安装命令, **Then** 成功安装 `@hestudy/tushare-mcp` 包或完成本地构建
2. **Given** 用户已获取 Tushare Token, **When** 按照文档配置环境变量或配置文件, **Then** MCP 服务能成功读取 Token 并启动
3. **Given** 用户使用 Claude Desktop, **When** 按照文档修改 `claude_desktop_config.json` 配置文件, **Then** Claude Desktop 成功加载 Tushare MCP 服务器
4. **Given** MCP 服务配置错误(如 Token 缺失), **When** 用户尝试启动服务或查询数据, **Then** 文档中包含常见错误排查指南帮助定位问题

---

### User Story 3 - 用户通过示例学习 MCP 工具的使用方法 (Priority: P3)

开发者已经成功配置 MCP 服务,现在想了解如何在 AI 对话中调用各种数据查询工具(如查询股票行情、财务数据、K线数据)。他阅读文档中的示例对话,理解如何向 AI 提问以触发相应的工具调用。

**Why this priority**: 示例对话和工具说明是用户熟练使用 MCP 服务的关键,但前提是用户已经完成了配置(P2)。这是增强功能,可以在基础配置步骤稳定后独立添加。

**Independent Test**: 可以独立测试 - 用户阅读文档中的示例对话,然后在自己的 AI 客户端中复现相同的查询,验证能否得到预期的数据响应。

**Acceptance Scenarios**:

1. **Given** 用户想查询股票行情, **When** 阅读文档中的"查询股票行情"示例, **Then** 文档提供清晰的示例对话和返回数据格式说明
2. **Given** 用户想查询财务数据, **When** 阅读文档中的"查询财务报表"示例, **Then** 文档说明如何指定报表类型(利润表/资产负债表/现金流量表)和报告期
3. **Given** 用户想查询 K 线数据, **When** 阅读文档中的"查询历史 K 线"示例, **Then** 文档说明如何指定时间范围和频率(日线/周线/月线)
4. **Given** 用户需要参考工具参数, **When** 查看文档中的工具列表, **Then** 每个工具都有完整的参数说明、是否必填、参数格式示例

---

### User Story 4 - 开发者通过进阶技巧优化 MCP 使用体验 (Priority: P4)

有经验的用户想要更高效地使用 MCP 服务,比如理解限流策略、调整日志级别、处理高并发查询场景。他查阅文档中的进阶技巧或配置说明,优化自己的使用方式。

**Why this priority**: 进阶技巧是为高级用户准备的优化内容,不影响基本使用。用户可以先掌握基础使用(P1-P3)后,再根据需要学习进阶内容。

**Independent Test**: 可以独立测试 - 高级用户按照文档调整配置(如限流参数、日志级别),验证配置是否生效,并观察性能或调试体验的改善。

**Acceptance Scenarios**:

1. **Given** 用户遇到频繁的限流错误, **When** 查阅文档中的限流说明, **Then** 文档解释默认限流策略并提供调整环境变量的方法
2. **Given** 用户需要调试 MCP 服务问题, **When** 查阅文档中的日志配置, **Then** 文档说明如何设置 `LOG_LEVEL` 环境变量查看详细日志
3. **Given** 用户想批量查询多只股票数据, **When** 阅读文档中的并发请求建议, **Then** 文档提供合理的并发控制策略和示例代码(如果涉及自定义客户端)

---

### Edge Cases

- **文档更新不及时**: 当 MCP 服务版本升级后,文档中的配置示例、工具列表、参数格式与实际版本不一致,导致用户配置失败。应在文档中标注版本号,并保持同步更新。
- **不同 AI 客户端的配置差异**: 文档只提供 Claude Desktop 的配置示例,但用户使用其他 MCP 客户端(如 VSCode Cline)时不知如何配置。应提供多种客户端的配置示例或通用配置说明。
- **用户没有 Tushare Token**: 用户直接跳过 Token 获取步骤尝试配置 MCP 服务,导致启动失败。文档应在前置要求部分明确说明 Token 是必需的,并提供获取链接。
- **用户对 MCP 协议完全陌生**: 文档假设用户了解 MCP 是什么,但新用户可能完全不知道 MCP 协议。应提供 MCP 协议的简单介绍或外部参考链接。
- **多种安装方式混淆**: 文档同时提到"本地构建"和"通过 npm 安装",但没有明确说明各自的适用场景,导致用户不知道选择哪种方式。应清晰区分开发者使用和最终用户使用的安装方式。
- **配置文件路径错误**: 不同操作系统(macOS/Windows/Linux)的配置文件路径不同,文档只提供一种示例导致用户找不到配置文件。应提供所有主流操作系统的路径说明。
- **示例对话未覆盖所有工具**: 文档提供的示例对话只涉及部分工具(如只有股票行情示例),用户不知道如何使用其他工具(如财务数据、市场指数)。应为每个工具提供至少一个示例。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 文档站点必须在首页或功能特性区域展示 MCP 服务的功能介绍,说明它为 AI 模型提供 Tushare 数据查询能力
- **FR-002**: 文档站点必须在指南(guide)部分新增"MCP 使用指南"章节,或在快速开始页面中增加 MCP 使用部分
- **FR-003**: MCP 使用指南必须包含"什么是 MCP"的简短介绍或外部参考链接,帮助新用户理解 MCP 协议
- **FR-004**: MCP 使用指南必须列出前置要求,包括:Node.js 版本、有效的 Tushare Token、支持 MCP 的 AI 客户端
- **FR-005**: MCP 使用指南必须提供安装步骤,包括通过 npm 安装已发布包的方式(如 `npm install @hestudy/tushare-mcp`)
- **FR-006**: MCP 使用指南必须提供配置步骤,包括如何设置 Tushare Token(通过环境变量或配置文件)
- **FR-007**: MCP 使用指南必须提供至少一种主流 AI 客户端的配置示例(如 Claude Desktop 的 `claude_desktop_config.json` 配置)
- **FR-008**: MCP 使用指南必须说明不同操作系统(macOS/Windows/Linux)的配置文件路径
- **FR-009**: MCP 使用指南必须列出所有可用的 MCP 工具(如 query_stock_quote、query_financial、query_kline、query_index)及其用途
- **FR-010**: 对每个 MCP 工具,文档必须说明其参数列表、是否必填、参数格式、示例值
- **FR-011**: MCP 使用指南必须提供至少 3 个典型的使用示例对话,覆盖主要工具(如查询股票行情、查询财务数据、查询 K 线数据)
- **FR-012**: 每个示例对话必须包含:用户如何向 AI 提问、AI 调用的工具名称和参数、返回的数据格式示例
- **FR-013**: MCP 使用指南必须包含常见问题排查部分,涵盖至少 3 种常见错误场景(如 Token 无效、配置文件路径错误、服务启动失败)
- **FR-014**: MCP 使用指南可选包含进阶配置部分,说明如何调整限流参数、日志级别等环境变量
- **FR-015**: 文档必须在 MCP 使用指南中提供外部参考链接,包括:Tushare Token 获取页面、MCP 协议官网、AI 客户端(如 Claude Desktop)下载页面

### Key Entities *(include if feature involves data)*

- **文档页面**: 代表文档站点的一个独立页面(如"MCP 使用指南"),包含标题、内容结构、导航位置
- **配置示例**: 代表不同 AI 客户端或操作系统的配置文件示例,包含文件路径、JSON 格式配置内容、必填字段说明
- **工具说明**: 代表一个 MCP 工具的文档条目,包含工具名称、用途描述、参数列表、参数说明、示例值
- **示例对话**: 代表一个完整的使用示例,包含用户问题、AI 工具调用、参数值、返回数据格式

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 新用户能够在 10 分钟内阅读 MCP 使用指南并理解 MCP 服务的基本概念和功能
- **SC-002**: 用户能够在 15 分钟内按照文档完成 MCP 服务的安装、配置和首次成功查询(从零开始到看到数据结果)
- **SC-003**: 至少 90% 的用户能够根据文档中的配置示例成功配置一种 AI 客户端(如 Claude Desktop)
- **SC-004**: 用户在配置过程中遇到常见错误时,能够在文档的"常见问题"部分找到解决方案,无需外部搜索
- **SC-005**: 文档中的示例对话覆盖至少 75% 的常见数据查询场景(股票行情、财务数据、K线数据、市场指数)
- **SC-006**: 用户能够在文档站点的首页或导航菜单中,3 次点击以内找到 MCP 使用指南
- **SC-007**: 文档中的所有配置示例、命令、参数格式都是可直接复制粘贴使用的,无需手动修改即可运行(除了 Token 等个人敏感信息)

## Scope & Boundaries *(mandatory)*

### In Scope

- 在文档站点中新增或更新 MCP 使用指南页面
- 提供 MCP 服务的概念介绍、前置要求、安装配置步骤
- 提供至少一种 AI 客户端(Claude Desktop)的详细配置示例
- 说明不同操作系统的配置文件路径
- 列出所有 MCP 工具及其参数说明
- 提供至少 3 个典型使用场景的示例对话
- 提供常见问题排查指南
- 提供外部参考链接(Tushare、MCP 协议、AI 客户端)

### Out of Scope

- **不涉及 MCP 服务本身的代码修改**: 本功能只补充文档内容,不修改 `apps/tushare-mcp` 的任何代码或功能
- **不提供所有 AI 客户端的详细配置**: 仅提供一种主流客户端(Claude Desktop)的详细配置,其他客户端仅提供通用说明或外部链接
- **不包含 MCP 协议的深度技术文档**: 仅提供简单介绍和外部参考链接,不深入讲解 MCP 协议规范细节
- **不提供自定义 MCP 工具的开发指南**: 仅说明如何使用现有工具,不涉及开发新工具或修改工具的教程
- **不提供视频或交互式教程**: 仅提供文本文档和代码示例,不包含视频演示或在线交互式配置工具
- **不提供多语言文档**: 仅提供中文版本的 MCP 使用指南,不包含英文或其他语言翻译
- **不涉及文档站点的布局或样式修改**: 仅新增或更新文档内容,不涉及 rspress 站点配置或主题样式调整(除非必需)

## Assumptions & Dependencies *(mandatory)*

### Assumptions

- 文档站点已使用 rspress 构建并正常运行,支持 Markdown/MDX 格式
- 用户已了解基本的 Tushare SDK 使用方法,或至少阅读过快速开始指南
- 用户已安装 Node.js 18+ 运行环境
- 用户已拥有有效的 Tushare API Token(或知道如何获取)
- 用户使用的 AI 客户端支持标准 MCP 协议(如 Claude Desktop、Cline 等)
- 文档内容基于当前稳定版本的 MCP 服务(feature 013-apps-sdk-mcp 已实现)
- 用户能够理解 JSON 配置文件格式和基本的命令行操作

### Dependencies

- **内部依赖**: 依赖 `apps/tushare-mcp` MCP 服务已经开发完成且功能稳定(feature 013-apps-sdk-mcp)
- **内部依赖**: 依赖 `apps/docs` 文档站点项目结构和构建流程正常运行
- **内部依赖**: 依赖 `apps/tushare-mcp/README.md` 中已有的基础文档内容作为参考
- **外部依赖**: 依赖 Tushare Pro API 服务可用(用于示例验证)
- **外部依赖**: 依赖 MCP 协议标准和 AI 客户端(如 Claude Desktop)的稳定性
- **外部依赖**: 依赖用户能够访问 Tushare 官网获取 API Token
- **构建工具**: 依赖 rspress 构建工具能够正确渲染 Markdown 文档并生成静态站点

## Non-Functional Requirements *(optional)*

### Usability

- 文档语言应简洁易懂,避免过多技术术语,面向不熟悉 MCP 协议的普通开发者
- 配置步骤应按照用户实际操作顺序编排(安装 → 配置 Token → 配置客户端 → 验证)
- 所有示例代码和配置应使用代码块格式,方便复制粘贴
- 参数说明应使用表格或列表形式,清晰标注是否必填、数据类型、示例值
- 提供清晰的章节标题和子标题,便于用户快速定位所需信息
- 对常见错误提供具体的错误信息示例和解决方案,而不是泛泛而谈

### Maintainability

- 文档应模块化组织,便于未来更新(如新增工具或支持新客户端)
- 版本相关的信息(如支持的 Node.js 版本)应集中在"前置要求"部分,便于统一维护
- 外部链接应使用 Markdown 链接语法,便于批量检查和更新
- 文档结构应与 Tushare SDK 文档站点的其他页面保持一致(标题层级、代码风格等)

### Performance

- 文档页面加载时间不超过 2 秒(在正常网络条件下)
- 文档内容应合理分页,避免单个页面过长影响阅读体验(建议单页内容不超过 5000 字)

## Open Questions *(optional)*

暂无开放问题。所有关键内容决策已基于现有 MCP 服务实现(feature 013)和文档站点结构做出合理假设。
