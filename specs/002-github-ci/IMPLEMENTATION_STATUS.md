# GitHub CI è‡ªåŠ¨åŒ–å‘å¸ƒ - å®ç°çŠ¶æ€

**æ—¥æœŸ**: 2025-10-10  
**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ

## å®ç°æ¦‚è§ˆ

å·²æˆåŠŸå®ç°åŸºäº GitHub Actions çš„è‡ªåŠ¨åŒ– npm å‘å¸ƒæµç¨‹ï¼Œæ”¯æŒç¨³å®šç‰ˆæœ¬å’Œé¢„å‘å¸ƒç‰ˆæœ¬çš„è‡ªåŠ¨å‘å¸ƒã€‚

## å·²å®ŒæˆåŠŸèƒ½

### âœ… Phase 1: Setup (å…±äº«åŸºç¡€è®¾æ–½)
- [X] T001 éªŒè¯ç°æœ‰ CI workflow é…ç½®
- [X] T002 éªŒè¯ monorepo ç»“æ„å’Œ pnpm workspace é…ç½®
- [X] T003 éªŒè¯ç°æœ‰æµ‹è¯•å¥—ä»¶å¯æ­£å¸¸è¿è¡Œ

### âœ… Phase 2: Foundational (åŸºç¡€è®¾æ–½)
- [X] T004 é…ç½® npm è®¤è¯æœºåˆ¶ï¼ˆNPM_AUTOMATION_TOKENï¼‰
- [X] T005 éªŒè¯ npm token æƒé™
- [X] T006 é…ç½® package.json å‘å¸ƒè®¾ç½®

### âœ… Phase 3: User Story 1 - è‡ªåŠ¨å‘å¸ƒç¨³å®šç‰ˆæœ¬ (P1 - MVP)
- [X] T010 åˆ›å»ºå‘å¸ƒ workflow æ–‡ä»¶ `.github/workflows/publish.yml`
- [X] T011 é…ç½® workflow è§¦å‘æ¡ä»¶ï¼ˆpush tags: v*ï¼‰
- [X] T012 å®ç° Job 1: Test & Build
  - Checkout ä»£ç 
  - Setup Node.js å’Œ pnpm
  - å®‰è£…ä¾èµ–
  - æ‰§è¡Œ lintã€type-checkã€buildã€test
  - éªŒè¯æ„å»ºäº§ç‰©å®Œæ•´æ€§
- [X] T013 å®ç° Job 2: Publishï¼ˆä¾èµ– Test & Build æˆåŠŸï¼‰
  - ä»æ ‡ç­¾æå–ç‰ˆæœ¬å·ï¼ˆå»é™¤ v å‰ç¼€ï¼‰
  - åŒæ­¥ç‰ˆæœ¬å·åˆ° package.json
  - éªŒè¯ç‰ˆæœ¬å·ä¸€è‡´æ€§
  - æ£€æŸ¥ç‰ˆæœ¬å†²çªï¼ˆnpm viewï¼‰
  - éªŒè¯æ„å»ºäº§ç‰©å®Œæ•´æ€§
  - å‘å¸ƒåˆ° npmï¼ˆä½¿ç”¨ latest tagï¼‰
- [X] T014 å®ç°é”™è¯¯å¤„ç†é€»è¾‘
  - æµ‹è¯•å¤±è´¥ï¼šä¸­æ­¢å‘å¸ƒï¼Œè¾“å‡ºé”™è¯¯æç¤º
  - è®¤è¯å¤±è´¥ï¼šæ˜ç¡®æç¤ºæ›´æ–° NPM_AUTOMATION_TOKEN
  - ç‰ˆæœ¬å†²çªï¼šæç¤ºä½¿ç”¨æ–°ç‰ˆæœ¬å·
  - æ„å»ºäº§ç‰©ç¼ºå¤±ï¼šä¸­æ­¢å‘å¸ƒå¹¶æç¤º
- [X] T015 é…ç½® workflow æƒé™ï¼ˆcontents: write, id-token: writeï¼‰
- [X] T016 é…ç½®å¹¶å‘æ§åˆ¶ï¼ˆåŒä¸€æ ‡ç­¾æ’é˜Ÿï¼Œä¸åŒæ ‡ç­¾å¹¶è¡Œï¼‰
- [X] T017 æ·»åŠ è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼ˆç‰ˆæœ¬å·ã€å‘å¸ƒçŠ¶æ€ã€npm URLï¼‰
- [X] T018 é…ç½®è¶…æ—¶è®¾ç½®ï¼ˆTest & Build: 10min, Publish: 5minï¼‰

### âœ… Phase 4: User Story 2 - è‡ªåŠ¨å‘å¸ƒé¢„è§ˆç‰ˆæœ¬ (P2)
- [X] T022 åœ¨ Publish job ä¸­å®ç° dist-tag è‡ªåŠ¨æ¨æ–­é€»è¾‘
  - æ£€æµ‹ç‰ˆæœ¬å·æ˜¯å¦åŒ…å« `-`
  - æå–é¢„å‘å¸ƒæ ‡è¯†ç¬¦ï¼ˆalpha, beta, rc, nextï¼‰
  - ç¨³å®šç‰ˆæœ¬ä½¿ç”¨ `latest` tag
- [X] T023 æ›´æ–°å‘å¸ƒå‘½ä»¤æ”¯æŒåŠ¨æ€ dist-tag
- [X] T024 æ·»åŠ  dist-tag éªŒè¯é€»è¾‘
- [X] T025 æ›´æ–°æ—¥å¿—è¾“å‡ºæ˜¾ç¤º dist-tag ä¿¡æ¯

### âœ… Phase 5: User Story 3 - å‘å¸ƒé€šçŸ¥ä¸è®°å½• (P3)
- [X] T029 å®ç° Job 3: Create Releaseï¼ˆä¾èµ– Publish æˆåŠŸï¼‰
  - Setup ç¯å¢ƒ
  - è·å–ä¸Šä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾
  - ç”Ÿæˆ commit åˆ—è¡¨ï¼ˆè‡ªä¸Šæ¬¡å‘å¸ƒä»¥æ¥ï¼‰
- [X] T030 å®ç°å˜æ›´æ—¥å¿—ç”Ÿæˆé€»è¾‘
  - åŸºäº git log æå– commits
  - æ ¼å¼åŒ–ä¸º Markdown
  - æ·»åŠ  Full Changelog é“¾æ¥
- [X] T031 å®ç° GitHub Release åˆ›å»º
  - ä½¿ç”¨ `actions/create-release@v1`
  - è®¾ç½® release name å’Œ body
  - æ ¹æ®ç‰ˆæœ¬å·è®¾ç½® prerelease æ ‡è®°
- [X] T032 æ·»åŠ  Release åˆ›å»ºæˆåŠŸçš„æ—¥å¿—è¾“å‡ºï¼ˆRelease URLï¼‰
- [X] T033 é…ç½® Release job è¶…æ—¶ï¼ˆ3minï¼‰
- [X] T034 å¤„ç† Release åˆ›å»ºå¤±è´¥åœºæ™¯ï¼ˆä¸å½±å“ npm å‘å¸ƒç»“æœï¼‰

### âœ… Phase 6: Polish & Cross-Cutting Concerns
- [X] T036 ä¼˜åŒ– workflow æ€§èƒ½ï¼šå¯ç”¨ pnpm ç¼“å­˜
- [X] T037 æ·»åŠ  npm provenance é…ç½®
- [X] T039 æ·»åŠ  workflow çŠ¶æ€å¾½ç« åˆ° README.md
- [X] T040 æ›´æ–°é¡¹ç›®æ–‡æ¡£ï¼šæ·»åŠ å‘å¸ƒæµç¨‹è¯´æ˜åˆ° docs/api.md
- [X] T042 æ·»åŠ  workflow æ³¨é‡Šè¯´æ˜æ¯ä¸ªæ­¥éª¤çš„ç›®çš„

## å¾…å®Œæˆä»»åŠ¡

### ğŸ”„ æµ‹è¯•ä»»åŠ¡
- [ ] T007 [TEST] åˆ›å»º workflow æµ‹è¯•ç¯å¢ƒ
- [ ] T008 [TEST] ç¼–å†™ workflow éªŒè¯è„šæœ¬æ¡†æ¶
- [ ] T009 [US1] ç¼–å†™ç¨³å®šç‰ˆæœ¬å‘å¸ƒæµ‹è¯•ï¼ˆRed Phaseï¼‰
- [ ] T019 [US1] è¿è¡Œç¨³å®šç‰ˆæœ¬å‘å¸ƒæµ‹è¯•ï¼ˆGreen Phaseï¼‰
- [ ] T020 [US1] é‡æ„å’Œä¼˜åŒ–ï¼ˆRefactor Phaseï¼‰
- [ ] T021 [US2] ç¼–å†™é¢„å‘å¸ƒç‰ˆæœ¬æµ‹è¯•ï¼ˆRed Phaseï¼‰
- [ ] T026 [US2] è¿è¡Œé¢„å‘å¸ƒç‰ˆæœ¬æµ‹è¯•ï¼ˆGreen Phaseï¼‰
- [ ] T027 [US2] æ·»åŠ é¢„å‘å¸ƒç‰ˆæœ¬æµ‹è¯•åœºæ™¯åˆ°æ–‡æ¡£
- [ ] T028 [US3] ç¼–å†™ Release åˆ›å»ºæµ‹è¯•ï¼ˆRed Phaseï¼‰
- [ ] T035 [US3] è¿è¡Œ Release åˆ›å»ºæµ‹è¯•ï¼ˆGreen Phaseï¼‰
- [ ] T046 [TEST] ç¼–å†™å®Œæ•´çš„å›å½’æµ‹è¯•å¥—ä»¶
- [ ] T047 [TEST] æ‰§è¡Œå®Œæ•´çš„å›å½’æµ‹è¯•
- [ ] T048 [TEST] åˆ›å»ºæµ‹è¯•æ–‡æ¡£

### ğŸ”„ éªŒè¯ä»»åŠ¡
- [ ] T038 éªŒè¯æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡ï¼ˆç›®æ ‡ 3.5 åˆ†é’Ÿï¼Œæœ€å¤§ 10 åˆ†é’Ÿï¼‰
- [ ] T041 éªŒè¯ quickstart.md ä¸­çš„æ‰€æœ‰æ­¥éª¤å¯æ­£å¸¸æ‰§è¡Œ
- [ ] T043 éªŒè¯æ‰€æœ‰é”™è¯¯åœºæ™¯çš„æç¤ºä¿¡æ¯æ¸…æ™°æ˜ç¡®

### ğŸ”„ Monorepo æ”¯æŒï¼ˆå¯é€‰ï¼‰
- [ ] T044 å®ç° monorepo å˜æ›´æ£€æµ‹é€»è¾‘
- [ ] T045 æµ‹è¯• monorepo å¤šåŒ…å‘å¸ƒåœºæ™¯

## æ ¸å¿ƒæ–‡ä»¶

### æ–°å¢æ–‡ä»¶
- `.github/workflows/publish.yml` - å‘å¸ƒ workflow é…ç½®

### ä¿®æ”¹æ–‡ä»¶
- `README.md` - æ·»åŠ  CI/Publish çŠ¶æ€å¾½ç« 
- `docs/api.md` - æ·»åŠ å‘å¸ƒæµç¨‹è¯´æ˜

## ä½¿ç”¨æŒ‡å—

### å‰ç½®å‡†å¤‡

1. **é…ç½® npm Token**:
   - åœ¨ npmjs.com ç”Ÿæˆ Granular Access Tokenï¼ˆautomation ç±»å‹ï¼‰
   - åœ¨ GitHub repo settings â†’ Secrets ä¸­æ·»åŠ  `NPM_AUTOMATION_TOKEN`

### å‘å¸ƒç¨³å®šç‰ˆæœ¬

```bash
# åˆ›å»ºå¹¶æ¨é€ç‰ˆæœ¬æ ‡ç­¾
git tag v1.0.0
git push origin v1.0.0
```

### å‘å¸ƒé¢„è§ˆç‰ˆæœ¬

```bash
# Beta ç‰ˆæœ¬
git tag v1.1.0-beta.1
git push origin v1.1.0-beta.1

# Alpha ç‰ˆæœ¬
git tag v1.1.0-alpha.1
git push origin v1.1.0-alpha.1

# RC ç‰ˆæœ¬
git tag v1.1.0-rc.1
git push origin v1.1.0-rc.1
```

### è‡ªåŠ¨åŒ–æµç¨‹

1. **Test & Build** (çº¦ 2-3 åˆ†é’Ÿ)
   - Checkout ä»£ç 
   - å®‰è£…ä¾èµ–
   - æ‰§è¡Œ lintã€type-checkã€buildã€test
   - éªŒè¯æ„å»ºäº§ç‰©

2. **Publish** (çº¦ 1 åˆ†é’Ÿ)
   - æå–ç‰ˆæœ¬å·
   - åŒæ­¥åˆ° package.json
   - æ¨æ–­ dist-tag
   - æ£€æŸ¥ç‰ˆæœ¬å†²çª
   - å‘å¸ƒåˆ° npm

3. **Create Release** (çº¦ 30 ç§’)
   - ç”Ÿæˆå˜æ›´æ—¥å¿—
   - åˆ›å»º GitHub Release
   - è®¾ç½® prerelease æ ‡è®°

## æˆåŠŸæŒ‡æ ‡

### å·²è¾¾æˆ
- âœ… å®Œæ•´çš„è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹
- âœ… æ”¯æŒç¨³å®šç‰ˆæœ¬å’Œé¢„å‘å¸ƒç‰ˆæœ¬
- âœ… è‡ªåŠ¨æ¨æ–­ dist-tag
- âœ… è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- âœ… é”™è¯¯å¤„ç†å’Œæç¤º
- âœ… å¹¶å‘æ§åˆ¶
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼ˆpnpm ç¼“å­˜ï¼‰
- âœ… npm provenance æ”¯æŒ

### å¾…éªŒè¯
- â³ å‘å¸ƒæµç¨‹ < 5 åˆ†é’Ÿï¼ˆéœ€å®é™…æµ‹è¯•ï¼‰
- â³ è‡ªåŠ¨å‘å¸ƒæˆåŠŸç‡ â‰¥ 95%ï¼ˆéœ€ç§¯ç´¯æ•°æ®ï¼‰
- â³ å¤±è´¥å®šä½ < 1 åˆ†é’Ÿï¼ˆéœ€å®é™…æµ‹è¯•ï¼‰

## ä¸‹ä¸€æ­¥

### ç«‹å³å¯åš
1. **é…ç½® npm token** - åœ¨ GitHub Secrets ä¸­æ·»åŠ  `NPM_AUTOMATION_TOKEN`
2. **æµ‹è¯•å‘å¸ƒæµç¨‹** - æ¨é€æµ‹è¯•æ ‡ç­¾éªŒè¯å®Œæ•´æµç¨‹
3. **éªŒè¯é”™è¯¯å¤„ç†** - æµ‹è¯•å„ç§å¤±è´¥åœºæ™¯

### åç»­ä¼˜åŒ–
1. **æ·»åŠ æµ‹è¯•** - å®ç° workflow é›†æˆæµ‹è¯•
2. **æ€§èƒ½éªŒè¯** - æµ‹é‡å®é™…å‘å¸ƒæ—¶é—´
3. **Monorepo æ”¯æŒ** - å®ç°å¤šåŒ…å˜æ›´æ£€æµ‹ï¼ˆå¦‚éœ€è¦ï¼‰
4. **Conventional Commits** - å¢å¼ºå˜æ›´æ—¥å¿—æ ¼å¼ï¼ˆå¯é€‰ï¼‰

## æŠ€æœ¯æ ˆ

- **CI/CD**: GitHub Actions
- **åŒ…ç®¡ç†**: pnpm 8.x
- **Node.js**: 18.x, 20.x
- **å‘å¸ƒç›®æ ‡**: npm registry
- **å˜æ›´æ—¥å¿—**: GitHub Release Notes (åŸç”Ÿ)

## å‚è€ƒæ–‡æ¡£

- [Specification](./spec.md)
- [Implementation Plan](./plan.md)
- [Quick Start Guide](./quickstart.md)
- [Workflow Contract](./contracts/workflow-contract.md)
- [Tasks](./tasks.md)
