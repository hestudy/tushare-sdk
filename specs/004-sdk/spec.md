# Feature Specification: SDK每日指标快捷方法

**Feature Branch**: `004-sdk`  
**Created**: 2025-10-10  
**Status**: Draft  
**Input**: User description: "为sdk增加每日指标的快捷方法,官方文档:https://tushare.pro/document/2?doc_id=32"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 按交易日期获取所有股票每日指标 (Priority: P1)

作为SDK用户,我希望能够通过指定交易日期,快速获取该日期所有股票的每日基本面指标(如换手率、市盈率、市净率等),以便进行选股分析和报表展示。

**Why this priority**: 这是最核心的功能,按日期查询是最常见的使用场景,可以获取某个交易日所有股票的指标数据,是数据分析的基础。

**Independent Test**: 可以通过调用方法并传入特定交易日期(如'20180726'),验证返回的数据包含该日期的所有股票指标,并且数据格式正确。

**Acceptance Scenarios**:

1. **Given** SDK已初始化且有有效token, **When** 用户调用每日指标方法并传入交易日期'20180726', **Then** 返回该日期所有股票的每日指标数据,包含ts_code、trade_date、turnover_rate、volume_ratio、pe、pb等字段
2. **Given** SDK已初始化, **When** 用户调用每日指标方法并指定需要返回的字段列表(如只要ts_code、pe、pb), **Then** 返回的数据只包含指定的字段
3. **Given** SDK已初始化, **When** 用户查询的交易日期是非交易日, **Then** 返回空数据或明确提示该日期无数据

---

### User Story 2 - 按股票代码获取历史每日指标 (Priority: P2)

作为SDK用户,我希望能够通过指定股票代码,获取该股票的历史每日指标数据,以便分析单只股票的历史表现和趋势。

**Why this priority**: 这是第二常见的使用场景,用于分析特定股票的历史数据,支持单股分析和回测。

**Independent Test**: 可以通过调用方法并传入特定股票代码(如'600230.SH'),验证返回该股票的历史每日指标数据,且数据按日期排序。

**Acceptance Scenarios**:

1. **Given** SDK已初始化, **When** 用户调用每日指标方法并传入股票代码'600230.SH', **Then** 返回该股票的所有历史每日指标数据
2. **Given** SDK已初始化, **When** 用户同时传入股票代码和日期范围, **Then** 返回该股票在指定日期范围内的每日指标数据
3. **Given** SDK已初始化, **When** 用户传入不存在的股票代码, **Then** 返回空数据或明确的错误提示

---

### User Story 3 - 批量分页获取大量数据 (Priority: P3)

作为SDK用户,当我需要获取大量历史数据时(超过单次请求的6000条限制),我希望SDK能够自动处理分页逻辑,让我能够方便地获取完整的历史数据。

**Why this priority**: 这是高级功能,用于处理大数据量场景,提升用户体验,但不是核心MVP功能。

**Independent Test**: 可以通过请求超过6000条的数据(如多个交易日的全市场数据),验证SDK能够自动分页并返回完整数据集。

**Acceptance Scenarios**:

1. **Given** SDK已初始化, **When** 用户请求的数据量超过6000条, **Then** SDK自动进行多次请求并合并返回完整数据
2. **Given** SDK正在进行分页请求, **When** 某次请求失败, **Then** SDK能够提供清晰的错误信息,说明在哪个分页失败
3. **Given** SDK已初始化, **When** 用户请求大量数据, **Then** SDK提供进度反馈机制(如回调或事件)

---

### Edge Cases

- 当用户查询的交易日期是周末或节假日(非交易日)时,应返回空数据并提供友好提示
- 当用户的积分不足(少于2000积分)时,应返回明确的权限错误提示
- 当单次请求返回的数据正好是6000条时,如何判断是否还有更多数据需要分页
- 当网络请求超时或API返回错误时,应提供清晰的错误信息和重试建议
- 当用户同时传入股票代码和交易日期时,应返回该股票在该日期的指标数据(单条记录)
- 当用户传入的日期格式不正确时,应进行格式验证并提供清晰的错误提示

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: SDK MUST 提供获取每日指标数据的快捷方法,支持通过交易日期参数查询
- **FR-002**: SDK MUST 支持通过股票代码参数查询特定股票的每日指标数据
- **FR-003**: SDK MUST 支持同时传入股票代码和交易日期参数,返回特定股票在特定日期的指标数据
- **FR-004**: SDK MUST 支持自定义返回字段列表,允许用户只获取需要的字段以减少数据传输量
- **FR-005**: SDK MUST 验证输入参数的格式,对于日期参数必须是YYYYMMDD格式(如20181010)
- **FR-006**: SDK MUST 处理API的积分权限限制,当积分不足时返回清晰的错误信息
- **FR-007**: SDK MUST 处理单次请求6000条数据的限制,提供分页或循环提取的能力
- **FR-008**: SDK MUST 返回标准化的数据结构,包含所有官方文档定义的输出字段
- **FR-009**: SDK MUST 处理API返回的错误情况,提供统一的错误处理机制
- **FR-010**: SDK MUST 保持与现有SDK架构的一致性,使用相同的初始化和调用模式

### Key Entities

- **DailyBasic(每日指标)**: 代表股票的每日基本面指标数据,包含以下关键属性:
  - ts_code: 股票代码
  - trade_date: 交易日期
  - turnover_rate: 换手率
  - volume_ratio: 量比
  - pe: 市盈率
  - pb: 市净率
  - 以及其他基本面指标字段(根据官方API文档)

- **QueryParams(查询参数)**: 代表查询每日指标的参数对象,包含:
  - ts_code: 可选的股票代码
  - trade_date: 可选的交易日期
  - fields: 可选的字段列表
  - start_date: 可选的开始日期(用于范围查询)
  - end_date: 可选的结束日期(用于范围查询)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户能够在5行代码内完成每日指标数据的查询,包括SDK初始化和方法调用
- **SC-002**: 查询单个交易日的全市场数据(约4000只股票)能够在30秒内完成
- **SC-003**: SDK提供的错误信息能够让用户清楚了解问题原因和解决方案,减少90%的常见问题咨询
- **SC-004**: 方法命名和参数设计符合SDK的整体风格,新用户能够通过类型提示和文档快速上手
- **SC-005**: 单元测试覆盖率达到90%以上,包含所有主要场景和边界情况的测试用例
